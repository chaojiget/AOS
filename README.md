# AOS - AI Chat Assistant

ä¸€ä¸ªä½¿ç”¨ Next.jsã€LangGraph å’Œ OpenTelemetry æ„å»ºçš„AIèŠå¤©åº”ç”¨ï¼Œå…·æœ‰å®æ—¶ç›‘æ§å’Œè¿½è¸ªåŠŸèƒ½ã€‚

## ğŸ“ˆ é¡¹ç›®è¿›åº¦ï¼ˆæ›´æ–°äº 2025-09-26ï¼‰

- ğŸš§ å®‰å…¨ï¼šMCP æ¥å£æ¥å…¥ RBAC + å®¡è®¡æ—¥å¿—ï¼Œæ²™ç®±è¿è¡Œå†™å…¥ events/agent_runsï¼Œå¹¶æä¾›å‰ç«¯ Integrations/Agents ç®¡ç†é¡µé¢ã€‚
- ğŸš§ æ¶æ„ï¼šæ•´ç† AOS v0.1 MCP ä¼˜å…ˆè“å›¾ï¼Œæ˜ç¡® IA/æ¥å£/æ•°æ®æ¨¡å‹ä¸ M0-M2 é‡Œç¨‹ç¢‘ï¼ˆè¯¦è§ `docs/aos-v0.1-blueprint.md`ï¼‰ã€‚
- ğŸš§ åç«¯ï¼šå¼•å…¥ MCP ç½‘å…³/æ³¨å†Œè¡¨ã€æ²™ç®±è„šæœ¬è°ƒåº¦éª¨æ¶ï¼Œç°æŒä¹…åŒ–åˆ° Postgresï¼Œæ”¯æŒ `/mcp/*` æ¥å£ä¸ Agent è„šæœ¬å®šæ—¶æ‰§è¡Œã€‚
- âœ… äº‹ä»¶æ€»çº¿ï¼šè½åœ° Postgres Outbox `value_events` è¡¨ï¼Œæä¾› `/api/events` æŸ¥è¯¢ä¸ SSE è®¢é˜…ï¼Œå‰ç«¯ Chat Hub å®æ—¶å±•ç¤ºä»»åŠ¡æ”¶æ®ã€å®¡æ‰¹ä¸å¼‚å¸¸ã€‚
- ğŸš§ Projectsï¼šæ–°å¢ `/api/projects` è·¯ç”±ä¸å›æ”¾è§†å›¾ï¼Œæ”¯æŒæŸ¥çœ‹æ—¶é—´çº¿ã€äº§ç‰©å¹¶é‡è·‘ä»»åŠ¡å†™å…¥ä»·å€¼äº‹ä»¶ã€‚
- ğŸš§ Agentsï¼šæ²™ç®±è„šæœ¬æ”¯æŒè™šæ‹Ÿç¯å¢ƒç®¡ç†ï¼Œè‡ªåŠ¨æä¾›é»˜è®¤ç¯å¢ƒï¼Œå¹¶åœ¨ç‹¬ç«‹ã€Œæ²™ç®±ã€é¡µé¢ç»´æŠ¤å˜é‡ï¼Œè¿è¡Œæ—¶å¯å¤ç”¨å…±äº«é…ç½®ã€‚
- âœ… Integrationsï¼šæä¾› MCP æœåŠ¡å¥åº·å·¡æ£€ã€ç†”æ–­ä¸é…é¢ç­–ç•¥ç®¡ç†ï¼Œé¡µé¢å¯è§†åŒ–æˆåŠŸç‡/å»¶è¿Ÿå¹¶ä¸€é”®è°ƒæ•´ç­–ç•¥ã€‚
- âœ… åç«¯ï¼šExpress + LangGraph èŠå¤©ä»£ç†å·²å®Œæˆï¼Œæ”¯æŒä¼šè¯ä¸Šä¸‹æ–‡ã€SSE æµå¼è¾“å‡ºä¸ OpenAI æ¨¡å‹é…ç½®ã€‚
- âœ… åç«¯ï¼šLangGraph æ£€æŸ¥ç‚¹å­˜å‚¨è¿ç§»è‡³ PostgreSQLï¼Œå¤ç”¨è¿æ¥æ± å¹¶è‡ªåŠ¨åŒæ­¥ schema æ³¨é‡Šã€‚
- âœ… åç«¯ï¼šOpenTelemetry åŸ‹ç‚¹ç”Ÿæ•ˆï¼Œé¥æµ‹æ•°æ®ç°å·²åˆ‡æ¢è‡³ NATS JetStreamï¼ŒæŒ‰ç±»å‹åˆ’åˆ† `telemetry.*` ä¸»é¢˜æµï¼Œå¹¶é€šè¿‡ `/api/telemetry/*` API è¯»å–è¿½è¸ªã€æ—¥å¿—ã€æŒ‡æ ‡ä»¥åŠç»Ÿè®¡ä¿¡æ¯ã€‚
- âœ… å‰ç«¯ï¼šNext.js èŠå¤©å·¥ä½œå°ä¸Šçº¿ï¼Œå…·å¤‡æœ¬åœ°å¤šä¼šè¯å­˜å‚¨ã€è¿½è¸ª ID å±•ç¤ºä»¥åŠå®æ—¶è¾“å…¥æç¤ºï¼Œé»˜è®¤è¿é€šæµå¼èŠå¤©æ¥å£ã€‚
- âœ… å‰ç«¯ï¼šé¥æµ‹ä»ªè¡¨æ¿é¡µé¢å¯è§†åŒ–æœ€è¿‘è¿½è¸ªã€æ—¥å¿—ã€æŒ‡æ ‡ï¼Œå¹¶å¯å›æ”¾æœ¬åœ°å†å²ä¼šè¯ã€å…³è” Trace è¯¦æƒ…ã€‚
- âœ… Telemetryï¼šæ–°å¢ Trace ç€‘å¸ƒè§†å›¾ä¸å±‚çº§æ—¶é—´è½´ï¼Œæ”¯æŒä» Chat ä»·å€¼äº‹ä»¶ä¸€é”®è·³è½¬å¹¶é€šè¿‡ URL `traceId` å‚æ•°å®šä½æŒ‡å®šè¿½è¸ªã€‚

## ğŸš€ ç‰¹æ€§

- **AIèŠå¤©åŠ©æ‰‹**: åŸºäº LangGraph æ„å»ºçš„æ™ºèƒ½å¯¹è¯ç³»ç»Ÿ
- **å®æ—¶ç›‘æ§**: ä½¿ç”¨ OpenTelemetry æ”¶é›†é¥æµ‹æ•°æ®
- **æ•°æ®å­˜å‚¨**: PostgreSQL æŒä¹…åŒ– LangGraph æ£€æŸ¥ç‚¹ï¼Œé¥æµ‹è½åœ°è‡³ NATS JetStream æŒä¹…æµ
- **ç°ä»£UI**: ä½¿ç”¨ shadcn/ui ç»„ä»¶æ„å»ºçš„å“åº”å¼ç•Œé¢
- **å‰åç«¯åˆ†ç¦»**: Next.js å‰ç«¯ + Node.js åç«¯

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯

- **Next.js 15**: React æ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨
- **Tailwind CSS**: æ ·å¼æ¡†æ¶
- **shadcn/ui**: UI ç»„ä»¶åº“
- **Lucide React**: å›¾æ ‡åº“

### åç«¯

- **Node.js**: è¿è¡Œæ—¶ç¯å¢ƒ
- **Express**: Web æ¡†æ¶
- **LangGraph**: AI Agent æ¡†æ¶
- **OpenTelemetry**: å¯è§‚æµ‹æ€§
- **PostgreSQL**: LangGraph æ£€æŸ¥ç‚¹å­˜å‚¨
- **TypeScript**: ç±»å‹å®‰å…¨

## ğŸ“¦ å®‰è£…

### 1. å®‰è£…ä¾èµ–

```bash
npm run install:all
```

### 2. ç¯å¢ƒé…ç½®

åœ¨ `backend/.env` ä¸­é…ç½® `AOS_API_TOKENS`ï¼Œä¾‹å¦‚ï¼š`AOS_API_TOKENS={"dev-admin-token":"owner"}`ï¼Œç”¨äºæˆæƒè®¿é—® `/mcp/*` å—ä¿æŠ¤æ¥å£ã€‚

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp backend/.env.example backend/.env

# ç¼–è¾‘ç¯å¢ƒå˜é‡ï¼Œè®¾ç½®ä½ çš„ OpenAI API Key
nano backend/.env

# ï¼ˆå¯é€‰ï¼‰ä¸ºå‰ç«¯åˆ›å»º `.env.local` ç¯å¢ƒå˜é‡æ–‡ä»¶
touch .env.local
```

`backend/.env` éœ€åŒæ—¶å¡«å…¥æ•°æ®åº“è¿æ¥ä¸²ï¼Œç¤ºä¾‹ï¼š

```env
DATABASE_URL=postgres://aos:aos@localhost:5432/aos
LANGGRAPH_CHECKPOINT_URL=postgres://aos:aos@localhost:5432/aos
```

> ğŸ’¡ é¥æµ‹é˜Ÿåˆ—ä¾èµ– NATS JetStreamï¼Œå¯é€šè¿‡ `docker-compose up nats -d` å¯åŠ¨æœ¬åœ°å®ä¾‹ï¼Œå¹¶åœ¨ `backend/.env` ä¸­è®¾ç½® `NATS_URL`

### 3. é…ç½® OpenAI API Key

åœ¨ `backend/.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š

```env
OPENAI_API_KEY=your_openai_api_key_here
```

## ğŸš€ è¿è¡Œ

### å¼€å‘æ¨¡å¼

```bash
# å¯åŠ¨ Postgres ä¸ NATS JetStream
docker-compose up postgres nats -d

# åŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯
npm run dev

# æˆ–è€…åˆ†åˆ«å¯åŠ¨
npm run dev:frontend  # å‰ç«¯: http://localhost:3000
npm run dev:backend   # åç«¯: http://localhost:3001
```

### ç”Ÿäº§æ¨¡å¼

```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨æœåŠ¡
npm start
```

## ğŸ“± ä½¿ç”¨

1. **èŠå¤©ç•Œé¢**: è®¿é—® `http://localhost:3000` å¼€å§‹ä¸AIåŠ©æ‰‹å¯¹è¯
2. **ç›‘æ§ä»ªè¡¨æ¿**: è®¿é—® `http://localhost:3000/telemetry` æŸ¥çœ‹é¥æµ‹æ•°æ®

### å‰ç«¯ç¯å¢ƒå˜é‡

åœ¨æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼Œé…ç½®å‰ç«¯è¯·æ±‚åç«¯æ—¶ä½¿ç”¨çš„åŸºç¡€åœ°å€ï¼š

```env
NEXT_PUBLIC_BACKEND_URL=http://localhost:3001
```

åœ¨éƒ¨ç½²åˆ°ä¸åŒç¯å¢ƒæ—¶ï¼Œåªéœ€ä¿®æ”¹è¯¥å˜é‡ï¼Œå³å¯è®©èŠå¤©ä¸é¥æµ‹é¡µé¢æŒ‡å‘æ–°çš„åç«¯åœ°å€ã€‚

## ğŸ”§ API ç«¯ç‚¹

### èŠå¤© API

- `POST /api/chat` - å‘é€æ¶ˆæ¯ç»™AIåŠ©æ‰‹
- `POST /api/chat/stream` - æµå¼å“åº”

### é¥æµ‹ API

- `GET /api/telemetry/traces` - è·å–è¿½è¸ªæ•°æ®
- `GET /api/telemetry/logs` - è·å–æ—¥å¿—æ•°æ®
- `GET /api/telemetry/metrics` - è·å–æŒ‡æ ‡æ•°æ®
- `GET /api/telemetry/stats` - è·å–ç»Ÿè®¡ä¿¡æ¯

### é¡¹ç›®ä¸å›æ”¾ API

- `GET /api/projects` - è·å–é¡¹ç›®åˆ—è¡¨ä¸è¿è¡Œæ‘˜è¦
- `GET /api/projects/:projectId` - æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…ï¼ˆè¿è¡Œè®°å½•ã€SOP ç‰ˆæœ¬ï¼‰
- `GET /api/projects/:projectId/runs/:runId` - æŸ¥çœ‹è¿è¡Œè¯¦æƒ…ï¼ˆæ—¶é—´çº¿ã€äº§ç‰©ã€Trace IDï¼‰
- `POST /api/projects/:projectId/runs` - è§¦å‘æ–°è¿è¡Œæˆ–é‡è·‘æŒ‡å®šä»»åŠ¡

## ğŸ“Š ç›‘æ§åŠŸèƒ½

- **å®æ—¶è¿½è¸ª**: æ¯ä¸ªè¯·æ±‚éƒ½æœ‰å”¯ä¸€çš„trace ID
- **æ€§èƒ½ç›‘æ§**: å“åº”æ—¶é—´ã€é”™è¯¯ç‡ç­‰æŒ‡æ ‡
- **æ—¥å¿—èšåˆ**: ç»“æ„åŒ–æ—¥å¿—å­˜å‚¨å’ŒæŸ¥è¯¢
- **å¯è§†åŒ–ä»ªè¡¨æ¿**: å®æ—¶æ•°æ®å±•ç¤º

## ğŸ” æ•°æ®å­˜å‚¨

- **PostgreSQL**ï¼šLangGraph æ£€æŸ¥ç‚¹ä¸å†™å…¥å†å²ï¼Œè‡ªåŠ¨åˆ›å»º `checkpoints`ã€`writes`ã€`schema_annotations` è¡¨ã€‚
- **NATS JetStream**ï¼šOpenTelemetry è¿½è¸ªã€æ—¥å¿—ã€æŒ‡æ ‡åˆ†åˆ«å†™å…¥ `telemetry.traces`ã€`telemetry.logs`ã€`telemetry.metrics` ä¸»é¢˜æµï¼Œå¯é€šè¿‡ `/api/telemetry/*` API æ‹‰å–æœ€æ–°æ¶ˆæ¯æˆ–åŸºäº JetStream Consumer è®¢é˜…æ‰©å±•å®æ—¶åˆ†æã€‚

## ğŸ›¡ï¸ å®‰å…¨æ€§

- CORS é…ç½®
- Helmet å®‰å…¨ä¸­é—´ä»¶
- è¾“å…¥éªŒè¯
- é”™è¯¯å¤„ç†

## ğŸ“ å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
AOS/
â”œâ”€â”€ app/                    # Next.js åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ page.tsx           # èŠå¤©é¡µé¢
â”‚   â”œâ”€â”€ telemetry/         # é¥æµ‹é¡µé¢
â”‚   â””â”€â”€ api/               # API è·¯ç”±
â”œâ”€â”€ backend/               # Node.js åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ agents/        # LangGraph agents
â”‚   â”‚   â”œâ”€â”€ telemetry/     # OpenTelemetry é…ç½®
â”‚   â”‚   â””â”€â”€ routes/        # API è·¯ç”±
â”œâ”€â”€ components/            # React ç»„ä»¶
â””â”€â”€ lib/                  # å·¥å…·å‡½æ•°
```

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ–°çš„AIå·¥å…·**: åœ¨ `backend/src/agents/chat-agent.ts` ä¸­æ·»åŠ 
2. **æ–°çš„APIç«¯ç‚¹**: åœ¨ `backend/src/routes/` ä¸­åˆ›å»º
3. **æ–°çš„UIç»„ä»¶**: åœ¨ `components/` ä¸­æ·»åŠ 

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åç«¯è¿æ¥å¤±è´¥**
   - ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ 3001 ç«¯å£
   - æ£€æŸ¥ CORS é…ç½®

2. **OpenAI API é”™è¯¯**
   - éªŒè¯ API Key æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ API é¢åº¦

3. **æ•°æ®åº“é”™è¯¯**
   - ç¡®ä¿æœ¬åœ° Postgres æœåŠ¡å·²å¯åŠ¨ï¼ˆ`docker-compose ps`ï¼‰
   - æ£€æŸ¥ `DATABASE_URL`/`LANGGRAPH_CHECKPOINT_URL` æ˜¯å¦é…ç½®æ­£ç¡®
  - è‹¥é¥æµ‹åˆå§‹åŒ–å¤±è´¥ï¼Œç¡®è®¤ NATS å®¹å™¨å·²å¯åŠ¨å¹¶ç›‘å¬ 4222 ç«¯å£ï¼Œå¯é€šè¿‡ `docker-compose logs nats` æŸ¥çœ‹ JetStream å¯åŠ¨çŠ¶æ€ï¼Œæˆ–æ£€æŸ¥ `NATS_URL` æ˜¯å¦æŒ‡å‘æ­£ç¡®å®ä¾‹

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ issues å’Œ pull requestsï¼
